<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadrant Analizi | Time & Growity</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%); min-height: 100vh; color: #fff; }
        
        .header { background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .back-btn { padding: 8px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: transparent; color: #fff; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; }
        .back-btn:hover { background: rgba(255,255,255,0.1); }
        .logo { font-size: 18px; font-weight: 700; color: #4fc3f7; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; margin-right: 8px; }
        .btn-primary { background: linear-gradient(135deg, #4fc3f7, #29b6f6); color: #000; }
        
        .main-container { display: flex; height: calc(100vh - 56px); }
        
        .left-panel { width: 280px; background: rgba(255,255,255,0.02); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; }
        .panel-header { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .panel-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .segment-count { font-size: 12px; color: #888; }
        .segment-list { flex: 1; overflow-y: auto; padding: 8px; }
        .segment-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; cursor: pointer; margin-bottom: 4px; border: 1px solid transparent; }
        .segment-item:hover { background: rgba(255,255,255,0.05); }
        .segment-item.selected { background: rgba(79,195,247,0.15); border-color: rgba(79,195,247,0.3); }
        .segment-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .segment-details { flex: 1; min-width: 0; }
        .segment-name { font-size: 11px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .segment-parent { font-size: 9px; color: #666; }
        .tier-badge { padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 700; }
        .tier-super { background: #ffd700; color: #000; }
        .tier-t1 { background: #4caf50; color: #fff; }
        .tier-t2 { background: #2196f3; color: #fff; }
        .tier-t3 { background: #ff9800; color: #fff; }
        .tier-t4 { background: #f44336; color: #fff; }
        
        .center-panel { flex: 1; display: flex; flex-direction: column; padding: 16px; }
        .canvas-container { flex: 1; background: rgba(255,255,255,0.02); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        #quadrantCanvas { width: 100%; height: 100%; }
        .tooltip { position: fixed; background: rgba(0,0,0,0.95); padding: 12px 16px; border-radius: 10px; font-size: 12px; pointer-events: none; z-index: 1000; display: none; max-width: 280px; border: 1px solid rgba(255,255,255,0.1); }
        
        .right-panel { width: 300px; background: rgba(255,255,255,0.02); border-left: 1px solid rgba(255,255,255,0.1); overflow-y: auto; }
        .detail-section { padding: 14px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .detail-title { font-size: 10px; font-weight: 600; color: #888; text-transform: uppercase; margin-bottom: 10px; }
        .detail-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .detail-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .detail-name { font-size: 14px; font-weight: 600; }
        .detail-parent { font-size: 11px; color: #888; }
        
        .metrics-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .metric-box { background: rgba(255,255,255,0.03); border-radius: 6px; padding: 10px; text-align: center; }
        .metric-label { font-size: 8px; color: #888; margin-bottom: 4px; }
        .metric-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; padding: 6px; color: #4fc3f7; font-size: 14px; font-weight: 700; text-align: center; }
        .metric-input:focus { outline: none; border-color: #4fc3f7; }
        
        .tier-selector { display: flex; gap: 4px; flex-wrap: wrap; }
        .tier-option { padding: 6px 10px; border-radius: 6px; font-size: 10px; font-weight: 600; cursor: pointer; border: 2px solid transparent; opacity: 0.5; }
        .tier-option.selected { opacity: 1; border-color: #fff; }
        .tier-option.super { background: #ffd700; color: #000; }
        .tier-option.t1 { background: #4caf50; color: #fff; }
        .tier-option.t2 { background: #2196f3; color: #fff; }
        .tier-option.t3 { background: #ff9800; color: #fff; }
        .tier-option.t4 { background: #f44336; color: #fff; }
        
        .strategy-textarea { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; padding: 10px; color: #fff; font-size: 11px; line-height: 1.5; resize: none; min-height: 70px; }
        .strategy-textarea:focus { outline: none; border-color: #4fc3f7; }
        
        .platform-section { margin-top: 8px; }
        .platform-header { display: flex; align-items: center; gap: 6px; padding: 8px 10px; background: rgba(255,255,255,0.03); border-radius: 6px; }
        .platform-icon { width: 20px; height: 20px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        .platform-icon.meta { background: #1877f2; }
        .platform-icon.tiktok { background: #000; border: 1px solid #00f2ea; color: #00f2ea; }
        .platform-icon.dv360 { background: #34a853; }
        .platform-name { font-size: 11px; font-weight: 500; }
        .platform-content { padding: 8px 10px; font-size: 10px; color: #888; line-height: 1.5; }
        
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center; padding: 40px; }
        .empty-icon { font-size: 48px; margin-bottom: 12px; }
        .empty-title { font-size: 16px; font-weight: 600; color: #888; margin-bottom: 6px; }
        .empty-desc { font-size: 12px; }
        
        .legend { display: flex; gap: 10px; padding: 10px; background: rgba(255,255,255,0.02); border-top: 1px solid rgba(255,255,255,0.1); justify-content: center; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 4px; font-size: 10px; color: #888; }
        .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()">‚Üê Segment Se√ßimi</button>
            <div class="logo">üéØ Quadrant Analizi</div>
        </div>
        <div>
            <button class="btn btn-secondary" onclick="exportPNG()">üì• PNG</button>
            <button class="btn btn-secondary" onclick="exportData()">üìä Excel</button>
            <button class="btn btn-primary" onclick="saveChanges()">üíæ Kaydet</button>
        </div>
    </header>

    <div class="main-container">
        <div class="left-panel">
            <div class="panel-header">
                <div class="panel-title">Se√ßili Segmentler</div>
                <div class="segment-count" id="segmentCount">0 segment</div>
            </div>
            <div class="segment-list" id="segmentList"></div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background:#ffd700;"></div>S√ºper</div>
                <div class="legend-item"><div class="legend-dot" style="background:#4caf50;"></div>T1</div>
                <div class="legend-item"><div class="legend-dot" style="background:#2196f3;"></div>T2</div>
                <div class="legend-item"><div class="legend-dot" style="background:#ff9800;"></div>T3</div>
                <div class="legend-item"><div class="legend-dot" style="background:#f44336;"></div>T4</div>
            </div>
        </div>

        <div class="center-panel">
            <div class="canvas-container">
                <canvas id="quadrantCanvas"></canvas>
            </div>
            <div class="tooltip" id="tooltip"></div>
        </div>

        <div class="right-panel" id="rightPanel">
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üëÜ</div>
                <div class="empty-title">Segment Se√ßin</div>
                <div class="empty-desc">Detaylarƒ± g√∂rmek i√ßin bir segment se√ßin</div>
            </div>
            <div id="detailContent" style="display:none;">
                <div class="detail-section">
                    <div class="detail-header">
                        <div class="detail-icon" id="detailIcon">üë§</div>
                        <div>
                            <div class="detail-name" id="detailName">Segment Adƒ±</div>
                            <div class="detail-parent" id="detailParent">Ana Segment</div>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <div class="detail-title">Metrikler (D√ºzenlenebilir)</div>
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-label">Satƒ±n Alma Eƒüilimi</div>
                            <input type="number" class="metric-input" id="metricX" min="0" max="100" onchange="updateMetric('x')">
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Etkile≈üim Potansiyeli</div>
                            <input type="number" class="metric-input" id="metricY" min="0" max="100" onchange="updateMetric('y')">
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Eri≈üim Hacmi</div>
                            <input type="text" class="metric-input" id="metricSize" onchange="updateMetric('size')" placeholder="2.5M">
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <div class="detail-title">√ñncelik Tier</div>
                    <div class="tier-selector">
                        <div class="tier-option super" data-tier="S√ºper" onclick="setTier('S√ºper')">‚≠ê S√ºper</div>
                        <div class="tier-option t1" data-tier="T1" onclick="setTier('T1')">T1</div>
                        <div class="tier-option t2" data-tier="T2" onclick="setTier('T2')">T2</div>
                        <div class="tier-option t3" data-tier="T3" onclick="setTier('T3')">T3</div>
                        <div class="tier-option t4" data-tier="T4" onclick="setTier('T4')">T4</div>
                    </div>
                </div>
                <div class="detail-section">
                    <div class="detail-title">Strateji Notu</div>
                    <textarea class="strategy-textarea" id="strategyNote" placeholder="Bu segment i√ßin strateji..." onchange="updateStrategy()"></textarea>
                </div>
                <div class="detail-section">
                    <div class="detail-title">Platform Hedefleme</div>
                    <div class="platform-section">
                        <div class="platform-header"><div class="platform-icon meta">f</div><div class="platform-name">Meta</div></div>
                        <div class="platform-content" id="metaTargeting">-</div>
                    </div>
                    <div class="platform-section">
                        <div class="platform-header"><div class="platform-icon tiktok">‚ô™</div><div class="platform-name">TikTok</div></div>
                        <div class="platform-content" id="tiktokTargeting">-</div>
                    </div>
                    <div class="platform-section">
                        <div class="platform-header"><div class="platform-icon dv360">G</div><div class="platform-name">DV360</div></div>
                        <div class="platform-content" id="dv360Targeting">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let segments = [];
        let selectedSegmentId = null;
        let canvas, ctx;
        const padding = 60;

        const tierConfig = {
            'S√ºper': { color: '#ffd700', class: 'tier-super' },
            'T1': { color: '#4caf50', class: 'tier-t1' },
            'T2': { color: '#2196f3', class: 'tier-t2' },
            'T3': { color: '#ff9800', class: 'tier-t3' },
            'T4': { color: '#f44336', class: 'tier-t4' }
        };

        const themeColors = {
            'theme-blue': { bg: 'rgba(33,150,243,0.25)', border: '#2196f3' },
            'theme-purple': { bg: 'rgba(156,39,176,0.25)', border: '#9c27b0' },
            'theme-green': { bg: 'rgba(76,175,80,0.25)', border: '#4caf50' },
            'theme-orange': { bg: 'rgba(255,152,0,0.25)', border: '#ff9800' },
            'theme-red': { bg: 'rgba(244,67,54,0.25)', border: '#f44336' },
            'theme-cyan': { bg: 'rgba(0,188,212,0.25)', border: '#00bcd4' },
            'theme-pink': { bg: 'rgba(233,30,99,0.25)', border: '#e91e63' },
            'theme-teal': { bg: 'rgba(0,150,136,0.25)', border: '#009688' },
            'theme-indigo': { bg: 'rgba(63,81,181,0.25)', border: '#3f51b5' },
            'theme-amber': { bg: 'rgba(255,193,7,0.25)', border: '#ffc107' }
        };

        function init() {
            const savedSegments = localStorage.getItem('selectedSegments');
            if (!savedSegments) {
                alert('Segment se√ßimi bulunamadƒ±.');
                window.location.href = '../';
                return;
            }

            const rawSegments = JSON.parse(savedSegments);
            segments = rawSegments.map(seg => ({
                ...seg,
                x: Math.floor(Math.random() * 60) + 20,
                y: Math.floor(Math.random() * 60) + 20,
                size: seg.reach,
                tier: seg.reach >= 5000000 ? 'T1' : seg.reach >= 2000000 ? 'T2' : seg.reach >= 1000000 ? 'T3' : 'T4',
                strategy: ''
            }));

            canvas = document.getElementById('quadrantCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('click', handleClick);
            canvas.addEventListener('mouseleave', () => document.getElementById('tooltip').style.display = 'none');
            renderSegmentList();
            draw();
        }

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            draw();
        }

        function renderSegmentList() {
            const list = document.getElementById('segmentList');
            document.getElementById('segmentCount').textContent = `${segments.length} segment`;
            list.innerHTML = segments.map(seg => {
                const tier = tierConfig[seg.tier];
                const theme = themeColors[seg.theme] || themeColors['theme-blue'];
                return `<div class="segment-item ${selectedSegmentId === seg.id ? 'selected' : ''}" onclick="selectSegment('${seg.id}')">
                    <div class="segment-icon" style="background:${theme.bg};border:1px solid ${theme.border};">${seg.parentIcon}</div>
                    <div class="segment-details">
                        <div class="segment-name">${seg.name}</div>
                        <div class="segment-parent">${seg.parent}</div>
                    </div>
                    <span class="tier-badge ${tier.class}">${seg.tier === 'S√ºper' ? '‚≠ê' : seg.tier}</span>
                </div>`;
            }).join('');
        }

        function selectSegment(id) {
            selectedSegmentId = id;
            const seg = segments.find(s => s.id === id);
            if (!seg) return;
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('detailContent').style.display = 'block';
            const theme = themeColors[seg.theme] || themeColors['theme-blue'];
            document.getElementById('detailIcon').textContent = seg.parentIcon;
            document.getElementById('detailIcon').style.background = theme.bg;
            document.getElementById('detailName').textContent = seg.name;
            document.getElementById('detailParent').textContent = seg.parent;
            document.getElementById('metricX').value = seg.x;
            document.getElementById('metricY').value = seg.y;
            document.getElementById('metricSize').value = formatReach(seg.size);
            document.getElementById('strategyNote').value = seg.strategy || '';
            document.querySelectorAll('.tier-option').forEach(opt => opt.classList.toggle('selected', opt.dataset.tier === seg.tier));
            updatePlatformTargeting(seg);
            renderSegmentList();
            draw();
        }

        function updatePlatformTargeting(seg) {
            const p = seg.parent.toLowerCase();
            let meta = '‚Ä¢ Interest: Segment bazlƒ±<br>‚Ä¢ Behavior: Hedef davranƒ±≈ülar<br>‚Ä¢ Custom: √ñzel kitleler';
            let tiktok = '‚Ä¢ Interest: ƒ∞lgili kategoriler<br>‚Ä¢ Hashtag: #segment #hedef<br>‚Ä¢ Creator: ƒ∞√ßerik √ºreticileri';
            let dv360 = '‚Ä¢ Affinity: ƒ∞lgi kitleleri<br>‚Ä¢ In-Market: Satƒ±n alma niyeti<br>‚Ä¢ Custom Intent: Arama terimleri';
            
            if (p.includes('teknoloji') || p.includes('dijital') || p.includes('oyun')) {
                meta = '‚Ä¢ Interest: Technology, Gadgets<br>‚Ä¢ Behavior: Tech Enthusiasts<br>‚Ä¢ Custom: App Users';
                tiktok = '‚Ä¢ Interest: Tech, Gaming<br>‚Ä¢ Hashtag: #teknoloji #gaming<br>‚Ä¢ Creator: Tech reviewers';
                dv360 = '‚Ä¢ Affinity: Technophiles<br>‚Ä¢ In-Market: Electronics<br>‚Ä¢ Custom Intent: yeni telefon';
            } else if (p.includes('aile') || p.includes('ebeveyn')) {
                meta = '‚Ä¢ Interest: Parenting, Family<br>‚Ä¢ Behavior: Parents<br>‚Ä¢ Custom: Baby Product Buyers';
                tiktok = '‚Ä¢ Interest: Family, Kids<br>‚Ä¢ Hashtag: #aile #√ßocuk<br>‚Ä¢ Creator: Family influencers';
                dv360 = '‚Ä¢ Affinity: Parents<br>‚Ä¢ In-Market: Baby Products<br>‚Ä¢ Custom Intent: √ßocuk √ºr√ºnleri';
            } else if (p.includes('saƒülƒ±k') || p.includes('fitness') || p.includes('spor')) {
                meta = '‚Ä¢ Interest: Fitness, Health<br>‚Ä¢ Behavior: Gym Members<br>‚Ä¢ Custom: Fitness App Users';
                tiktok = '‚Ä¢ Interest: Fitness, Workout<br>‚Ä¢ Hashtag: #fitness #spor<br>‚Ä¢ Creator: Fitness influencers';
                dv360 = '‚Ä¢ Affinity: Health Buffs<br>‚Ä¢ In-Market: Fitness Equipment<br>‚Ä¢ Custom Intent: spor salonu';
            } else if (p.includes('alƒ±≈üveri≈ü') || p.includes('moda')) {
                meta = '‚Ä¢ Interest: Shopping, Fashion<br>‚Ä¢ Behavior: Engaged Shoppers<br>‚Ä¢ Custom: High-Value Buyers';
                tiktok = '‚Ä¢ Interest: Shopping, Hauls<br>‚Ä¢ Hashtag: #alƒ±≈üveri≈ü #moda<br>‚Ä¢ Creator: Fashion influencers';
                dv360 = '‚Ä¢ Affinity: Shopaholics<br>‚Ä¢ In-Market: Apparel<br>‚Ä¢ Custom Intent: indirim';
            } else if (p.includes('seyahat')) {
                meta = '‚Ä¢ Interest: Travel, Vacation<br>‚Ä¢ Behavior: Frequent Travelers<br>‚Ä¢ Custom: Travel Bookers';
                tiktok = '‚Ä¢ Interest: Travel, Explore<br>‚Ä¢ Hashtag: #seyahat #tatil<br>‚Ä¢ Creator: Travel vloggers';
                dv360 = '‚Ä¢ Affinity: Travel Buffs<br>‚Ä¢ In-Market: Travel, Hotels<br>‚Ä¢ Custom Intent: tatil';
            }
            document.getElementById('metaTargeting').innerHTML = meta;
            document.getElementById('tiktokTargeting').innerHTML = tiktok;
            document.getElementById('dv360Targeting').innerHTML = dv360;
        }

        function formatReach(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
            return num.toString();
        }

        function parseReach(str) {
            str = str.toString().toUpperCase().replace(/\s/g, '');
            if (str.includes('M')) return parseFloat(str) * 1000000;
            if (str.includes('K')) return parseFloat(str) * 1000;
            return parseInt(str) || 1000000;
        }

        function updateMetric(type) {
            if (!selectedSegmentId) return;
            const seg = segments.find(s => s.id === selectedSegmentId);
            if (!seg) return;
            if (type === 'x') seg.x = Math.min(100, Math.max(0, parseInt(document.getElementById('metricX').value) || 50));
            else if (type === 'y') seg.y = Math.min(100, Math.max(0, parseInt(document.getElementById('metricY').value) || 50));
            else if (type === 'size') seg.size = parseReach(document.getElementById('metricSize').value);
            draw();
        }

        function setTier(tier) {
            if (!selectedSegmentId) return;
            const seg = segments.find(s => s.id === selectedSegmentId);
            if (!seg) return;
            seg.tier = tier;
            document.querySelectorAll('.tier-option').forEach(opt => opt.classList.toggle('selected', opt.dataset.tier === tier));
            renderSegmentList();
            draw();
        }

        function updateStrategy() {
            if (!selectedSegmentId) return;
            const seg = segments.find(s => s.id === selectedSegmentId);
            if (seg) seg.strategy = document.getElementById('strategyNote').value;
        }

        function draw() {
            const width = canvas.width, height = canvas.height;
            ctx.fillStyle = '#0f0f1a';
            ctx.fillRect(0, 0, width, height);
            const chartWidth = width - padding * 2, chartHeight = height - padding * 2;
            const centerX = padding + chartWidth / 2, centerY = padding + chartHeight / 2;

            // Quadrants
            ctx.fillStyle = 'rgba(255,235,59,0.03)'; ctx.fillRect(padding, padding, chartWidth/2, chartHeight/2);
            ctx.fillStyle = 'rgba(76,175,80,0.05)'; ctx.fillRect(centerX, padding, chartWidth/2, chartHeight/2);
            ctx.fillStyle = 'rgba(244,67,54,0.03)'; ctx.fillRect(padding, centerY, chartWidth/2, chartHeight/2);
            ctx.fillStyle = 'rgba(33,150,243,0.03)'; ctx.fillRect(centerX, centerY, chartWidth/2, chartHeight/2);

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.05)'; ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                ctx.beginPath(); ctx.moveTo(padding + (chartWidth/10)*i, padding); ctx.lineTo(padding + (chartWidth/10)*i, height-padding); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(padding, padding + (chartHeight/10)*i); ctx.lineTo(width-padding, padding + (chartHeight/10)*i); ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = 'rgba(255,255,255,0.2)'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(centerX, padding); ctx.lineTo(centerX, height-padding); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(padding, centerY); ctx.lineTo(width-padding, centerY); ctx.stroke();

            // Labels
            ctx.font = '10px Segoe UI'; ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.textAlign = 'center';
            ctx.fillText('Y√ºksek Etkile≈üim / D√º≈ü√ºk Satƒ±n Alma', padding + chartWidth/4, padding + 16);
            ctx.fillText('Y√ºksek Etkile≈üim / Y√ºksek Satƒ±n Alma', centerX + chartWidth/4, padding + 16);
            ctx.fillText('Satƒ±n Alma Eƒüilimi ‚Üí', width/2, height - 10);
            ctx.save(); ctx.translate(14, height/2); ctx.rotate(-Math.PI/2); ctx.fillText('Etkile≈üim Potansiyeli ‚Üí', 0, 0); ctx.restore();

            // Segments
            const maxReach = Math.max(...segments.map(s => s.size), 1);
            segments.forEach(seg => {
                const x = padding + (seg.x / 100) * chartWidth;
                const y = padding + ((100 - seg.y) / 100) * chartHeight;
                const baseSize = (seg.size / maxReach) * 35 + 12;
                const size = selectedSegmentId === seg.id ? baseSize * 1.2 : baseSize;
                const theme = themeColors[seg.theme] || themeColors['theme-blue'];
                const tier = tierConfig[seg.tier];

                if (selectedSegmentId === seg.id) {
                    ctx.beginPath(); ctx.arc(x, y, size + 8, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(79,195,247,0.3)'; ctx.fill();
                }
                ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = theme.bg; ctx.fill();
                ctx.strokeStyle = theme.border; ctx.lineWidth = selectedSegmentId === seg.id ? 3 : 2; ctx.stroke();

                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                if (seg.tier === 'S√ºper') { ctx.font = `${size > 20 ? 16 : 12}px Segoe UI`; ctx.fillStyle = '#ffd700'; ctx.fillText('‚≠ê', x, y); }
                else { ctx.font = `bold ${size > 20 ? 11 : 9}px Segoe UI`; ctx.fillStyle = tier.color; ctx.fillText(seg.tier, x, y); }
            });
        }

        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left, my = e.clientY - rect.top;
            const chartWidth = canvas.width - padding * 2, chartHeight = canvas.height - padding * 2;
            const maxReach = Math.max(...segments.map(s => s.size), 1);
            let found = null;
            segments.forEach(seg => {
                const x = padding + (seg.x / 100) * chartWidth;
                const y = padding + ((100 - seg.y) / 100) * chartHeight;
                const size = (seg.size / maxReach) * 35 + 12;
                if (Math.sqrt((mx - x) ** 2 + (my - y) ** 2) < size) found = seg;
            });
            const tooltip = document.getElementById('tooltip');
            if (found) {
                canvas.style.cursor = 'pointer';
                tooltip.innerHTML = `<div style="font-weight:600;margin-bottom:4px;">${found.parentIcon} ${found.name}</div><div style="color:#888;font-size:10px;margin-bottom:6px;">${found.parent}</div><div style="display:flex;gap:12px;font-size:11px;"><div><span style="color:#4fc3f7;font-weight:600;">${found.x}</span> Satƒ±n Alma</div><div><span style="color:#4fc3f7;font-weight:600;">${found.y}</span> Etkile≈üim</div><div><span style="color:#4fc3f7;font-weight:600;">${formatReach(found.size)}</span> Eri≈üim</div></div>`;
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
            } else {
                canvas.style.cursor = 'default';
                tooltip.style.display = 'none';
            }
        }

        function handleClick(e) {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left, my = e.clientY - rect.top;
            const chartWidth = canvas.width - padding * 2, chartHeight = canvas.height - padding * 2;
            const maxReach = Math.max(...segments.map(s => s.size), 1);
            let found = null;
            segments.forEach(seg => {
                const x = padding + (seg.x / 100) * chartWidth;
                const y = padding + ((100 - seg.y) / 100) * chartHeight;
                const size = (seg.size / maxReach) * 35 + 12;
                if (Math.sqrt((mx - x) ** 2 + (my - y) ** 2) < size) found = seg;
            });
            if (found) selectSegment(found.id);
        }

        function goBack() { window.location.href = '../'; }
        function exportPNG() { const link = document.createElement('a'); link.download = 'quadrant.png'; link.href = canvas.toDataURL('image/png'); link.click(); }
        function exportData() {
            let html = '<html><head><meta charset="UTF-8"></head><body><table border="1"><tr><th>Segment</th><th>Ana Segment</th><th>Satƒ±n Alma</th><th>Etkile≈üim</th><th>Eri≈üim</th><th>Tier</th><th>Strateji</th></tr>';
            segments.forEach(seg => { html += `<tr><td>${seg.name}</td><td>${seg.parent}</td><td>${seg.x}</td><td>${seg.y}</td><td>${formatReach(seg.size)}</td><td>${seg.tier}</td><td>${seg.strategy||'-'}</td></tr>`; });
            html += '</table></body></html>';
            const blob = new Blob([html], { type: 'application/vnd.ms-excel' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'segment-analizi.xls'; link.click();
        }
        function saveChanges() { localStorage.setItem('quadrantSegments', JSON.stringify(segments)); alert('Kaydedildi!'); }
        init();
    </script>
</body>
</html>
